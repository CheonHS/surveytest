<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.surveytest.example.mapper.SurveyMapper">

	<!-- 새 설문지 작성 -->
	<insert id="surveyWrite" parameterType="Survey">
		INSERT INTO st_survey(
			s_title,
			s_description
		) VALUES (
			'',
			''
		)
		<selectKey resultType="int" keyProperty="sId" order="AFTER">
        	SELECT LAST_INSERT_ID()
    	</selectKey>   
	</insert>
	
	<!-- 설문지 목록 -->
	<select id="surveyList" resultType="Survey">
	
		SELECT		ROW_NUMBER() OVER(ORDER BY s_id) as rownum,
					s_id	as	sId,
					s_title as	title
		FROM		st_survey					
	</select>
	
	<!-- 설문지 삭제 -->
	<delete id="surveyDelete" parameterType="Survey">
		DELETE FROM st_survey
		WHERE		s_id = #{sId}
	</delete>
	
	<!-- 설문지 정보 -->
	<select id="surveyRow" parameterType="Survey" resultType="Survey">
		SELECT		s_id			as	sId,
					s_title			as	title,
					s_description	as	description
		FROM		st_survey
		WHERE		s_id = #{sId}
		
	</select>
	
	<!-- 설문지 수정 -->
	<update id="surveyEdit" parameterType="Survey">
		UPDATE		st_survey
		SET			s_title	= #{title},
					s_description = #{description}
		WHERE		s_id = #{sId}
	</update>
	
	<!-- 질문 추가 -->
	<insert id="addQuestion" parameterType="Survey">
		INSERT INTO st_question(
			q_type,
			q_value,
			s_id
		) VALUES (
			'1',
			'',
			#{sId}
		)
	</insert>
	<!-- 질문 목록 -->
	<select id="listQuestion" parameterType="Survey" resultType="Question" >
		SELECT		q_id			as	qId,
					q_type			as	type,
					q_value			as	qValue
		FROM		st_question
		WHERE		s_id = #{sId}
	</select>
	
</mapper>